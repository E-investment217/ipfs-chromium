FROM debian
RUN apt-get update
RUN apt-get install --yes apt-utils
RUN apt-get install --yes g++ python3 python3-pip git ninja-build wget
RUN wget 'https://github.com/Kitware/CMake/releases/download/v3.25.2/cmake-3.25.2-linux-x86_64.tar.gz'
# Debian version of cmake is weirdly old. I could try to support it, but some of my dependencies don't.
# Alternatively, one could get cmake from conan. But then we wouldn't be adequately testing the cmake code that installs conan.
RUN tar --extract --verbose --strip-components=1 --file cmake*.tar.gz

RUN for c in cmake ninja;do which ${c};${c} --version;done

RUN echo "alias ll='/bin/ls -lrth --color=auto '" >> /root/.bashrc

RUN echo "TODO - probably wan't to setup /chromium/src/ here, before ipfs-chromium, as it might change less frequently"

ADD . /ipfs-chromium

ARG PROFILE=Debug

RUN mkdir -p /ipfs-chromium-${PROFILE}
RUN cmake -G Ninja -D CMAKE_BUILD_TYPE=${PROFILE} -S /ipfs-chromium -B /ipfs-chromium-${PROFILE}
RUN ninja -C /ipfs-chromium-${PROFILE} -j 1

RUN echo TODO Chromium component build
